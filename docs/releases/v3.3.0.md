# Disaster recovery Core Module Release 3.3.0

Welcome to the latest release of the `DR` module of [`SIGHUP Distribution`](https://github.com/sighupio/distribution) maintained by team SIGHUP by ReeVo.

This latest release upgrades the components in the module to their latest stable release.

## Component Images ðŸš¢

| Component                           | Supported Version                                                                                   | Previous Version |
|-------------------------------------|-----------------------------------------------------------------------------------------------------|------------------|
| `velero`                            | [`v1.17.1`](https://github.com/vmware-tanzu/velero/releases/tag/v1.17.1)                            | `1.16.2`         |
| `velero-plugin-for-aws`             | [`v1.13.1`](https://github.com/vmware-tanzu/velero-plugin-for-aws/releases/tag/v1.13.1)             | `v1.12.1`         |
| `velero-plugin-for-microsoft-azure` | [`v1.13.1`](https://github.com/vmware-tanzu/velero-plugin-for-microsoft-azure/releases/tag/v1.13.1) | `v1.12.1`         |
| `velero-plugin-for-gcp`             | [`v1.13.1`](https://github.com/vmware-tanzu/velero-plugin-for-gcp/releases/tag/v1.13.1)             | `v1.12.1`         |
| `snapshot-controller`               | [`v8.4.0`](https://github.com/kubernetes-csi/external-snapshotter/releases/tag/v8.4.0)              | `v8.3.0`              |

> Please refer to the individual release notes to get a detailed information on each release.

## Features ðŸ’¥

- Add support for Kubernetes 1.34
- Drop support for Kubernetes 1.29, 1.30
- Update Velero to v1.17.1
- Update Velero on-premises Minio server to `RELEASE.2025-07-23T15-54-02Z`
- Update plugins
- Add `node-agent-config` configmap and `--node-agent-configmap` argument to the node-agent daemonset to support Velero's [`prepareQueueLength`](https://velero.io/docs/v1.17/node-agent-prepare-queue-length/) configuration.

## Bug Fixes ðŸ›

- Exclude etcd-backup-s3, etcd-backup-pvc pods and jobs from Velero backups.

## Breaking Changes ðŸ’”

> [!WARNING]
> This release includes breaking changes from Velero v1.17.1. Please review carefully before upgrading.

### Restic Deprecation

Velero has removed support for `--uploader-type=restic` in v1.17.0 `deployment.yaml:28-34`
You can no longer create new backups using Restic, but existing Restic backups can still be restored until v1.19
This module already uses `--uploader-type=kopia` as the default since v3.0.0, so new deployments are unaffected

### Repository Maintenance Configuration Changes

The following Velero server parameters have been removed and are now configured via a ConfigMap:
`--keep-latest-maintenance-jobs`
`--maintenance-job-cpu-request`
`--maintenance-job-mem-request`
`--maintenance-job-cpu-limit`
`--maintenance-job-mem-limit`

### Migration Required for Restic Users

If you're currently using Restic for file system backups (upgrading from versions before `v3.0.0`), you must:

- Complete any ongoing Restic backups before upgrading
- Plan migration to Kopia for future file system backups

Note that existing Restic backups will remain restorable until Velero `v1.19`
This follows the pattern established in previous releases like `v2.2.0` where breaking changes were clearly documented with warning boxes

## Upgrade Guide ðŸ¦®

To upgrade this module from v3.2.0 to v3.3.0, you need to download this new version and then:

1. Upgrade Velero CRDs
```bash
# Upgrade CRDs
kubectl apply -f katalog/velero-base/crds.yaml
```

2. Upgrade Velero
```yaml
# Upgrade Velero
kustomize build katalog/velero/velero-aws | kubectl apply -f -
# Or
kustomize build katalog/velero/velero-gcp | kubectl apply -f -
# Or
kustomize build katalog/velero/velero-azure | kubectl apply -f -
# Or, if the cluster is on-premise remove the minio-setup job first
kubectl delete job -n kube-system minio-setup
kustomize build katalog/velero/velero-on-prem | kubectl apply -f -
```

3. *(Optional) Install/upgrade the snapshot controller*:
if you want to enable VolumeSnapshots as backups, you can install and/or upgrade the [`snapshot-controller`](../../katalog/velero/snapshot-controller/) package.

```yaml
# Install snapshot-controller
kustomize build katalog/velero/snapshot-controller | kubectl apply -f -
```